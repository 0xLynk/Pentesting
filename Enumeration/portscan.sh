#!/bin/bash

# Enable filename completion
shopt -s progcomp

# Ask for user input for the scope file with tab completion enabled
read -e -p "Please enter the path to your scope file (e.g., scope.txt): " scope_file

# Check if the file exists
if [[ ! -f $scope_file ]]; then
  echo "The file '$scope_file' does not exist. Please provide a valid file."
  exit 1
fi

# Create directories for reports
mkdir -p Host-Discovery-Reports Full-Scan-Reports

# Perform host discovery scan
nmap -p21,22,23,25,53,80,110,111,135,139,143,161,443,445,465,587,636,993,995,1433,1521,2222,3306,3389,3780,5432,5601,5900,5985,5986,6379,7001,8000,8080,8081,8088,8090,8443,8888,9200,9300,10000,10001,10050,10443,11211,20000,27000,27017,33848,50000,50030,50070,61616,62078 -T4 -oA Host-Discovery-Reports/Host-Enumeration-Report -iL "$scope_file"

# Extract live hosts
grep 'open' Host-Discovery-Reports/Host-Enumeration-Report.gnmap | awk '/Ports:/{print $2}' | sort -u > Host-Discovery-Reports/livehosts.txt

# Generate HTML report for host discovery
xsltproc Host-Discovery-Reports/Host-Enumeration-Report.xml -o Host-Discovery-Reports/Host-Enumeration-Report.html

# Perform full port scan on live hosts
nmap -iL Host-Discovery-Reports/livehosts.txt -p- -T4 -oA Full-Scan-Reports/fullportscan

# Generate HTML report for full port scan
xsltproc Full-Scan-Reports/fullportscan.xml -o Full-Scan-Reports/fullportscan.html

# Completion message
echo "Scan complete. Reports are saved in 'Host-Discovery-Reports' and 'Full-Scan-Reports' directories."
